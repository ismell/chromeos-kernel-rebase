From de0656c93301d97d400d352af13b3ee9b0841932 Mon Sep 17 00:00:00 2001
From: Stephen Boyd <swboyd@chromium.org>
Date: Mon, 25 Mar 2019 10:24:56 -0700
Subject: [PATCH] BACKPORT: FROMGIT: PM / wakeup: Use pm_pr_dbg() instead of
 pr_debug()

These prints are useful if we're doing PM suspend debugging. Having them
at pr_debug() level means that we need to either enable DEBUG in this
file, or compile the kernel with dynamic debug capabilities. Both of
these options have drawbacks like custom compilation or opting into all
debug statements being included into the kernel image. Given that we
already have infrastructure to collect PM debugging information with
CONFIG_PM_DEBUG and friends, let's change the pr_debug usage here to be
pm_pr_dbg() instead so we can collect the wakeup information in the
kernel logs.

Signed-off-by: Stephen Boyd <swboyd@chromium.org>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
(cherry picked from commit 74a1dd86d1739eae2015a3832f62c1d6546893a7
 git://git.kernel.org/pub/scm/linux/kernel/git/rafael/linux-pm.git linux-next)

Conflicts:
   drivers/base/power/wakeup.c

We modified this in commit d0f62c0e44a9 ("CHROMIUM: PM: Do not silence
the print of last active wakeup source") and therefore this patch undoes
that change and moves to pm_pr_dbg() instead.

BUG=b:110133453
TEST=Run a suspend/resume cycle and look for the power prints showing
the wakeup event

Change-Id: Icef6e327c187b27eadecc2ac1a9ec9333c636ef8
Signed-off-by: Stephen Boyd <swboyd@chromium.org>
Reviewed-on: https://chromium-review.googlesource.com/1549541
Reviewed-by: Ravi Chandra Sadineni <ravisadineni@chromium.org>

[rebase419(rrangel): There was a CHROMIUM patch that made one of
the pr_debug into a pr_info. It was reverted in a merge. This patch
is realy just UPSTREAM now.]
Signed-off-by: Raul E Rangel <rrangel@chromium.org>
---
 drivers/base/power/wakeup.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/base/power/wakeup.c b/drivers/base/power/wakeup.c
index 7c84f64c74f77..851e931bada60 100644
--- a/drivers/base/power/wakeup.c
+++ b/drivers/base/power/wakeup.c
@@ -818,7 +818,7 @@ void pm_print_active_wakeup_sources(void)
 	srcuidx = srcu_read_lock(&wakeup_srcu);
 	list_for_each_entry_rcu(ws, &wakeup_sources, entry) {
 		if (ws->active) {
-			pr_debug("active wakeup source: %s\n", ws->name);
+			pm_pr_dbg("active wakeup source: %s\n", ws->name);
 			active = 1;
 		} else if (!active &&
 			   (!last_activity_ws ||
@@ -829,7 +829,7 @@ void pm_print_active_wakeup_sources(void)
 	}
 
 	if (!active && last_activity_ws)
-		pr_debug("last active wakeup source: %s\n",
+		pm_pr_dbg("last active wakeup source: %s\n",
 			last_activity_ws->name);
 	srcu_read_unlock(&wakeup_srcu, srcuidx);
 }
@@ -859,7 +859,7 @@ bool pm_wakeup_pending(void)
 	raw_spin_unlock_irqrestore(&events_lock, flags);
 
 	if (ret) {
-		pr_debug("PM: Wakeup pending, aborting suspend\n");
+		pm_pr_dbg("Wakeup pending, aborting suspend\n");
 		pm_print_active_wakeup_sources();
 	}
 
-- 
2.22.0.770.g0f2c4a37fd-goog

